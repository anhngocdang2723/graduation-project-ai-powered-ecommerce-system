nodes:
  - id: root
    label: "Menu"
    type: group
    children:
      # --- GUEST CONTEXT ---
      - id: guest_root
        label: "Kh√°ch"
        type: group
        condition: is_guest
        children:
          - id: guest_auth
            label: "üë§ T√†i kho·∫£n"
            type: group
            children:
              - id: login
                label: "üîë ƒêƒÉng nh·∫≠p"
                tag: "action:login"
                type: link
                value: "/login"
              - id: register
                label: "üìù ƒêƒÉng k√Ω"
                tag: "action:register"
                type: link
                value: "/register"
          
          - id: guest_shopping
            label: "üõçÔ∏è Mua s·∫Øm"
            type: group
            children:
              - id: new_arrivals
                label: "‚ú® S·∫£n ph·∫©m m·ªõi"
                tag: "action:new_arrivals"
                type: link
                value: "/search?sort=created_at"
              - id: promotions
                label: "üî• Khuy·∫øn m√£i"
                tag: "action:promotions"
                type: link
                value: "/collections/sale"

          - id: guest_support
            label: "üí¨ H·ªó tr·ª£"
            type: group
            children:
              - id: guest_tracking
                label: "üì¶ Tra c·ª©u ƒë∆°n h√†ng"
                tag: "action:guest_tracking"
                type: link
                value: "/order/status"
              - id: shipping_policy
                label: "üöö Ch√≠nh s√°ch v·∫≠n chuy·ªÉn"
                tag: "action:shipping_policy"
                type: link
                value: "/policy/shipping"
              - id: return_policy
                label: "üîÑ ƒê·ªïi tr·∫£ & Ho√†n ti·ªÅn"
                tag: "action:return_policy"
                type: link
                value: "/policy/returns"
              - id: contact_us
                label: "Li√™n h·ªá"
                tag: "action:contact_us"
                type: link
                value: "/contact"

      # --- CUSTOMER CONTEXT ---
      - id: customer_root
        label: "Kh√°ch h√†ng"
        type: group
        condition: is_customer
        children:
          - id: customer_orders
            label: "üì¶ ƒê∆°n h√†ng"
            tag: "scope:order"
            type: group
            children:
              - id: list_orders
                label: "üìã ƒê∆°n h√†ng c·ªßa t√¥i"
                tag: "action:order_list"
                type: action
              - id: track_order
                label: "üöö Tra c·ª©u v·∫≠n chuy·ªÉn"
                tag: "action:order_track"
                type: action
              - id: reorder
                label: "üîÑ Mua l·∫°i ƒë∆°n c≈©"
                tag: "action:reorder"
                type: action

          - id: customer_profile
            label: "üë§ T√†i kho·∫£n"
            tag: "scope:profile"
            type: group
            children:
              - id: view_profile
                label: "‚öôÔ∏è Th√¥ng tin c√° nh√¢n"
                tag: "action:view_profile"
                type: link
                value: "/account"
              - id: logout
                label: "üö™ ƒêƒÉng xu·∫•t"
                tag: "action:logout"
                type: action
              - id: view_profile
                label: "Th√¥ng tin c√° nh√¢n"
                tag: "action:profile_view"
                type: link
                value: "/account"
              - id: addresses
                label: "S·ªï ƒë·ªãa ch·ªâ"
                tag: "action:addresses"
                type: link
                value: "/account/addresses"
              - id: wishlist
                label: "S·∫£n ph·∫©m y√™u th√≠ch"
                tag: "action:wishlist"
                type: link
                value: "/wishlist"
              - id: logout
                label: "ƒêƒÉng xu·∫•t"
                tag: "action:logout"
                type: action

          - id: customer_support
            label: "H·ªó tr·ª£"
            type: group
            children:
              - id: chat_human
                label: "G·∫∑p nh√¢n vi√™n h·ªó tr·ª£"
                tag: "action:chat_human"
                type: action
              - id: my_reviews
                label: "ƒê√°nh gi√° c·ªßa t√¥i"
                tag: "action:my_reviews"
                type: action

      # --- STAFF CONTEXT ---
      - id: staff_root
        label: "Nh√¢n vi√™n"
        type: group
        condition: is_staff
        children:
          - id: staff_tools
            label: "C√¥ng c·ª• kho"
            tag: "scope:staff"
            type: group
            children:
              - id: check_stock
                label: "Ki·ªÉm tra t·ªìn kho"
                tag: "action:check_stock"
                type: action
              - id: check_price
                label: "Tra c·ª©u gi√°"
                tag: "action:check_price"
                type: action
          
          - id: staff_orders
            label: "Qu·∫£n l√Ω ƒë∆°n"
            type: group
            children:
              - id: lookup_order_staff
                label: "Tra c·ª©u ƒë∆°n h√†ng"
                tag: "action:staff_lookup_order"
                type: action
              - id: customer_lookup
                label: "Tra c·ª©u kh√°ch h√†ng"
                tag: "action:staff_customer_lookup"
                type: action
              - id: fulfillment
                label: "X·ª≠ l√Ω ƒë∆°n h√†ng"
                type: group
                children:
                  - id: update_status
                    label: "C·∫≠p nh·∫≠t tr·∫°ng th√°i"
                    tag: "action:update_order_status"
                    type: action
                  - id: print_label
                    label: "In v·∫≠n ƒë∆°n"
                    tag: "action:print_shipping_label"
                    type: action

      # --- MANAGER CONTEXT ---
      - id: manager_root
        label: "Qu·∫£n l√Ω"
        type: group
        condition: is_manager
        children:
          - id: manager_reports
            label: "B√°o c√°o"
            tag: "scope:manager"
            type: group
            children:
              - id: sales_report
                label: "B√°o c√°o doanh s·ªë"
                tag: "action:sales_report"
                type: action
              - id: top_products
                label: "S·∫£n ph·∫©m b√°n ch·∫°y"
                tag: "action:top_products"
                type: action
              - id: customer_analytics
                label: "Ph√¢n t√≠ch kh√°ch h√†ng"
                tag: "action:customer_analytics"
                type: action

      # --- COMMON CONTEXT (Cart) ---
      - id: cart
        label: "Gi·ªè h√†ng"
        tag: "scope:cart"
        type: group
        children:
          - id: view_cart
            label: "Xem gi·ªè h√†ng"
            tag: "action:view_cart"
            type: link
            value: "/cart"
          - id: checkout
            label: "Thanh to√°n"
            tag: "action:checkout"
            type: link
            value: "/checkout"
            condition: is_not_guest # Example: Only show checkout if logged in (or maybe guest checkout is allowed, but let's test condition)

intent_mapping:
  create_order:
    guest: guest_auth
    customer: cart
  order_tracking:
    guest: guest_auth # Force login to track? Or maybe track by ID
    customer: customer_orders
  view_cart:
    all: cart
  profile_view:
    customer: customer_profile
    guest: guest_auth
  staff_check_stock:
    staff: staff_tools
    manager: staff_tools
  sales_report:
    manager: manager_reports
